{% include 'templates/partials/modal/admin/pricing/_new-adjustment.html'%} 
{% include 'templates/partials/modal/admin/pricing/_edit-adjustment.html'%} 
{% include 'templates/partials/modal/admin/financial/_new-company-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_edit-company-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_edit-location-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_new-location-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_edit-department-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_new-department-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_edit-profit-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_new-profit-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_edit-gl-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_new-gl-code.html'%} 
{% include 'templates/partials/modal/admin/financial/_edit-code-layout.html'%}
<div class="multisteps-form__panel p-4 rounded js-active" data-animation="scaleIn">
  <div class="heading-arrows-container d-flex justify-content-between">
    <button class="multistep-form__arrow"><i class="fa fa-solid fa-chevron-left"></i></button>
    <h3 class="multisteps-form__title text-center">Adjustments</h3>
    <button class="multistep-form__arrow"><i class="fa fa-solid fa-chevron-right"></i></button>
  </div>

  <div class="multisteps-form__content">
    <div class="">
      <div class="save-container">
        <button class="btn btn-secondary-light">Save Changes</button>
      </div>

      <div class="">
        <div class="tabcontent">
          <div class="btn-search-container">
            <div class="row">
              <div class="col-lg-6 col-md-12">
                <div class="filter-container">
                  <button class="btn btn-secondary" onclick="document.getElementById('newAdjustment').style.display='block'"><i class="fa fa-solid fa-plus"></i> New Adjustment </button>
                  <div class="filters d-flex align-items-center"><a href="" class="active">Active</a>&nbsp;|&nbsp;<a href="">Inactive</a>&nbsp;|&nbsp;<a href="">Archived</a></div>
                </div>
              </div>
              <div class="col-lg-6 col-md-12 search-container">
                <div class="form-group has-search">
                  <input type="text" class="form-control" placeholder="Search..." />
                  <span class="fa fa-search form-control-feedback"></span>
                </div>
              </div>
            </div>
            <hr />
          </div>

          <div class="table-container mt-3">
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">ID</th>
                  <th scope="col">Name</th>
                  <th scope="col">Code</th>
                  <th scope="col">Value</th>
                  <th scope="col">Credit/Debit</th>
                  <th scope="col">Apply Level</th>
                  <th scope="col">Section</th>
                  <th scope="col">GL Codes</th>
                  <th scope="col">Status</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody>
                {% for adjustment in adjustments %}
                <tr>
                  <td>{{adjustment.id}}</td>
                  <td>{{adjustment.name}}</td>
                  <td>{{adjustment.code}}</td>
                  <td>{{adjustment.value}}{% if adjustment.value_type == 'amount' %}$ {% else %}%{% endif %}</td>
                  <td>{{adjustment.type}}</td>
                  <td>{{adjustment.apply_level}}</td>
                  <td>{{adjustment.section_id}}</td>
                  <td>{{adjustment.gl_code}}</td>
                  <td>
                    <div class="switch2">
                      <input id="cc-toggle-{{adjustment.id}}" class="check-toggle check-toggle-round-flat" type="checkbox" {% if not adjustment.active %} checked {% endif %} disabled/>
                      <label for="cc-toggle-{{adjustment.id}}"></label>

                      <span class="active">Active</span>
                      <span class="deactivate">Deactivate</span>
                    </div>
                  </td>
                  <td>
                    <span class="pe-5" onclick="editAdjustment(`{{ adjustment.id }}`)"><i class="fa fa-solid fa-pencil"></i></span>
                    <span><i class="fa fa-solid fa-envelope-open"></i></span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="end-of-list-heading-container text-center py-5">
              <span>You've reached the end!</span>
            </div>
          </div>
        </div>
      </div>

      <div class="save-container d-flex justify-content-end mt-5">
        <button class="btn btn-secondary-light">Save Changes</button>
      </div>
    </div>
    <script>
      function editAdjustment(id) {
        document.getElementById('editAdjustment').style.display='block';
        var selectElement = document.querySelector('.edit-adjustment-lstBox1');
        while (selectElement.firstChild) {
            selectElement.removeChild(selectElement.firstChild);
        }
        var selectElement = document.querySelector('.edit-adjustment-lstBox2');
        while (selectElement.firstChild) {
            selectElement.removeChild(selectElement.firstChild);
        }
        let data = {'id': id}
        fetch("pricing/adjustment-detail", {
          method: "POST",
          credentials: "same-origin",
          headers: {
              "X-CSRFToken": "{{ csrf_token }}",
              "Accept": "application/json",
              'Content-Type': 'application/json'
          },
          body: JSON.stringify(data),
        }).then((response) => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json(); // parse the JSON from the response
        })
        .then((data) => {
            var adjustment = JSON.parse(data['adjustment']);
            adjustment = adjustment[0].fields;
            var assigned_publications = data['assigned_publications'];
            var unsigned_publications = data['unsigned_publications'];
            localStorage.setItem('edit-adjustment-id', data['id']);
            localStorage.setItem('edit-adjustment-active', adjustment.active);
            localStorage.setItem('edit-adjustment-status', adjustment.status);
            document.getElementById('edit-adjustment-name').value = adjustment.name;
            document.getElementById('edit-adjustment-code').value = adjustment.code;
            document.getElementById('edit-adjustment-apply-level').value = adjustment.apply_level;
            document.getElementById('edit-adjustment-section').value = adjustment.section;
            document.getElementById('edit-adjustment-value-type').value = adjustment.value_type;
            document.getElementById('edit-adjustment-type').value = adjustment.type;
            document.getElementById('edit-adjustment-value').value = adjustment.value;
            document.getElementById('edit-adjustment-prompt-for-value').value = adjustment.prompt_for_value;
            document.getElementById('edit-adjustment-gl-code').value = adjustment.gl_code;
            document.getElementById('adminadjustment-active').textContent = adjustment.active == true ? 'Deactivate' : 'Active';
            var select = document.querySelector(".edit-adjustment-lstBox1");
            unsigned_publications.forEach(function(item) {
              var option = new Option(item.name, item.id);
              select.add(option);
            });
            var select = document.querySelector(".edit-adjustment-lstBox2");
            assigned_publications.forEach(function(item) {
              var option = new Option(item.name, item.id);
              select.add(option);
            });
        })
        .catch((error) => {
            console.log(error);
        });
      }
    </script>
  </div>
</div>
